<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> SLAE32 - Assignment 6 - Polymorphism | Andrea Perfetti</title>
  <meta name="description" content="YHQL, YLGL, YLFL.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="SLAE32 - Assignment 6 - Polymorphism" />
<meta property="og:description" content="The sixth assigment for the SLAE32 certification asks to select 3 shellcodes from Shell-Storm and create a polymorphic version of them in order to beat pattern matching.
The polymorphic version cannot be larger more than 150% of the original shellcode.
For each shellcode, the following steps have been followed:
 Download the shellcode into &lt;Name&gt;-Shellstorm&lt;ID&gt;.txt Extract the shellcode and pass it to ndisasm with the command:
echo --ne &quot;&lt;SHELLCODE&gt;&quot; | ndisasm -u - &gt; original_disasm." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://andrea-perfetti.github.io/posts/slae32-exam/2021-03-07-slae32-assignment-6/" />
<meta property="article:published_time" content="2021-03-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-03-11T00:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SLAE32 - Assignment 6 - Polymorphism"/>
<meta name="twitter:description" content="The sixth assigment for the SLAE32 certification asks to select 3 shellcodes from Shell-Storm and create a polymorphic version of them in order to beat pattern matching.
The polymorphic version cannot be larger more than 150% of the original shellcode.
For each shellcode, the following steps have been followed:
 Download the shellcode into &lt;Name&gt;-Shellstorm&lt;ID&gt;.txt Extract the shellcode and pass it to ndisasm with the command:
echo --ne &quot;&lt;SHELLCODE&gt;&quot; | ndisasm -u - &gt; original_disasm."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://andrea-perfetti.github.io/css/style-white.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://andrea-perfetti.github.io/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="https://www.andreaperfetti.it/">About me</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://andrea-perfetti.github.io/posts/2021-03-06-hello-world/">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&text=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&is_video=false&description=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=SLAE32%20-%20Assignment%206%20-%20Polymorphism&body=Check out this article: https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-stumbleupon " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-digg " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&name=SLAE32%20-%20Assignment%206%20-%20Polymorphism&description=The%20sixth%20assigment%20for%20the%20SLAE32%20certification%20asks%20to%20select%203%20shellcodes%20from%20Shell-Storm%20and%20create%20a%20polymorphic%20version%20of%20them%20in%20order%20to%20beat%20pattern%20matching.%0aThe%20polymorphic%20version%20cannot%20be%20larger%20more%20than%20150%25%20of%20the%20original%20shellcode.%0aFor%20each%20shellcode%2c%20the%20following%20steps%20have%20been%20followed%3a%0a%20Download%20the%20shellcode%20into%20%26lt%3bName%26gt%3b-Shellstorm%26lt%3bID%26gt%3b.txt%20Extract%20the%20shellcode%20and%20pass%20it%20to%20ndisasm%20with%20the%20command%3a%0aecho%20--ne%20%26quot%3b%26lt%3bSHELLCODE%26gt%3b%26quot%3b%20%7c%20ndisasm%20-u%20-%20%26gt%3b%20original_disasm.">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&t=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#exit">Exit</a>
      <ul>
        <li><a href="#ver-1">Ver. 1</a></li>
        <li><a href="#ver-2">Ver. 2</a></li>
      </ul>
    </li>
    <li><a href="#forkbomb">ForkBomb</a></li>
    <li><a href="#killall">KillAll</a></li>
  </ul>
</nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        SLAE32 - Assignment 6 - Polymorphism
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2021-03-11 00:00:00 &#43;0000 UTC" itemprop="datePublished">2021-03-11</time>
          
        </div>
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/slae32-exam-assignments">SLAE32 Exam Assignments</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/slae32" rel="tag">SLAE32</a>
            
        </div>
        
      </div>
    </header>

  
    <div class="content" itemprop="articleBody">
      <p>The sixth assigment for the SLAE32 certification asks to select 3 shellcodes from <a href="http://shell-storm.org/">Shell-Storm</a> and create a polymorphic version of them in order to beat pattern matching.</p>
<p>The polymorphic version cannot be larger more than 150% of the original shellcode.</p>
<p>For each shellcode, the following steps have been followed:</p>
<ul>
<li>Download the shellcode into <code>&lt;Name&gt;-Shellstorm&lt;ID&gt;.txt</code></li>
<li>Extract the shellcode and pass it to ndisasm with the command:<br>
<code>echo --ne &quot;&lt;SHELLCODE&gt;&quot; | ndisasm -u - &gt; original_disasm.txt</code></li>
<li>Rebuild it into <code>original.nasm</code></li>
<li>Create polymorphic version <code>poly.nasm</code></li>
</ul>
<h2 id="exit">Exit</h2>
<p>The first shellcode I have selected is <a href="http://shell-storm.org/shellcode/files/shellcode-55.php">Exit</a>.<br>
Its purpose is to perform a <code>exit(1)</code> function, therefore is very short.
The lenght of the original shellcode is 7 bytes.</p>
<p>The shellcode is first XORing EAX to set it to zero, it is then incrementing EAX, copying it to EBX and then invoking the syscall with interrupt 0x80.</p>
<h3 id="ver-1">Ver. 1</h3>
<p>We can create a first polymorphic version of the shellcode by exchanging the register being used.
<code>poly-ver1.nasm</code> is first XORing EBX to set it to zero, then incrementing it and copying to EAX before the syscall.<br>
With this approach we basically changed the shellcode without affecting neither the output nor the size, as this version has same exact size of the original (7 bytes).</p>
<h3 id="ver-2">Ver. 2</h3>
<p><code>poly-ver2.nasm</code> proposes a different method for zeroing EAX, which is subtracting a register with itself.
After that, we are writing 0x1 into al (not to use null bytes), copying EAX into EBX and then invoking the syscall.<br>
This version is 8 bytes long, 1 byte longer than the original one (114%).</p>
<h2 id="forkbomb">ForkBomb</h2>
<p>The second shellcode I have selected is <a href="http://shell-storm.org/shellcode/files/shellcode-214.php">ForkBomb</a>.<br>
This shellcode is very simple: it just sets EAX to 0x2 by pushing the byte onto the stack and then popping into EAX, executes the system call <code>__NR_fork</code> and then jumps to the beginning, thus creating an infinite loop.<br>
The original shellcode is 7 bytes long.</p>
<p>For the polymorphic version I have decided to go with a <em>classic</em> XOR operation to set EAX to zero and then a MOV to set its lower portion to 0x2.</p>
<p>The polymorphic version is 8 bytes long, 1 byte longer than the original one (114%).</p>
<h2 id="killall">KillAll</h2>
<p>The third shellcode I have selected is <a href="http://shell-storm.org/shellcode/files/shellcode-212.php">Kill All Processes</a>.<br>
The purpose of this shellcode is to execute syscall 0x25 (37 in decimal: <code>__NR_kill</code>) with -1 as <em>pid</em> parameter (thus affecting ALL processes, according to <a href="https://man7.org/linux/man-pages/man2/kill.2.html">man page</a>) and 9 (SIGKILL) as <em>sig</em> parameter.</p>
<p>This shellcode is not using direct assignment, it is rather pushing the three values on the stack and then popping in the appropriate registers before invoking the syscall.The original shellcode is 11 bytes long.</p>
<p>For the polymorphic version I have decided to proceed as follows:</p>
<ul>
<li>Set EAX to zero subtracting it to itself</li>
<li>Set EBX and ECX to zero by copying value from EAX</li>
<li>Set AL to 0x25 (DEC 37) with MOV</li>
<li>Set EBX to -1 by decrementing it</li>
<li>Set CL to 0c9 with MOV</li>
<li>Invoke the 0x80 interrupt</li>
</ul>
<p>The polymorphic version is 13 bytes long, 1 byte longer than the original one (118%).</p>
<!-- raw HTML omitted -->
<hr>
<p>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification: <a href="http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/">http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a>.</p>
<p><strong>Student ID</strong>: <code>SLAE - 1547</code><br>
<strong>GitHub repository</strong>: <a href="https://github.com/andrea-perfetti/SLAE32-Exam">https://github.com/andrea-perfetti/SLAE32-Exam</a></p>
<p>This assignment has been written on a Kali Linux 2021.1 x86 virtual machine:</p>
<pre><code>┌──(kali㉿kali)-[~]
└─$ uname -a 
Linux kali 5.10.0-kali3-686-pae #1 SMP Debian 5.10.13-1kali1 (2021-02-08) i686 GNU/Linux
</code></pre><!-- raw HTML omitted -->

    </div>
  </article>

  
  





  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="https://www.andreaperfetti.it/">About me</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#exit">Exit</a>
      <ul>
        <li><a href="#ver-1">Ver. 1</a></li>
        <li><a href="#ver-2">Ver. 2</a></li>
      </ul>
    </li>
    <li><a href="#forkbomb">ForkBomb</a></li>
    <li><a href="#killall">KillAll</a></li>
  </ul>
</nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&text=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&is_video=false&description=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=SLAE32%20-%20Assignment%206%20-%20Polymorphism&body=Check out this article: https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&title=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-digg fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&name=SLAE32%20-%20Assignment%206%20-%20Polymorphism&description=The%20sixth%20assigment%20for%20the%20SLAE32%20certification%20asks%20to%20select%203%20shellcodes%20from%20Shell-Storm%20and%20create%20a%20polymorphic%20version%20of%20them%20in%20order%20to%20beat%20pattern%20matching.%0aThe%20polymorphic%20version%20cannot%20be%20larger%20more%20than%20150%25%20of%20the%20original%20shellcode.%0aFor%20each%20shellcode%2c%20the%20following%20steps%20have%20been%20followed%3a%0a%20Download%20the%20shellcode%20into%20%26lt%3bName%26gt%3b-Shellstorm%26lt%3bID%26gt%3b.txt%20Extract%20the%20shellcode%20and%20pass%20it%20to%20ndisasm%20with%20the%20command%3a%0aecho%20--ne%20%26quot%3b%26lt%3bSHELLCODE%26gt%3b%26quot%3b%20%7c%20ndisasm%20-u%20-%20%26gt%3b%20original_disasm.">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fandrea-perfetti.github.io%2fposts%2fslae32-exam%2f2021-03-07-slae32-assignment-6%2f&t=SLAE32%20-%20Assignment%206%20-%20Polymorphism">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Andrea Perfetti 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="https://www.andreaperfetti.it/">About me</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>



</html>
